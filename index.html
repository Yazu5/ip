<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Messages</title>
    <style>
        /* SECURITY SHIELD */
        * {
            margin: 0; padding: 0; box-sizing: border-box;
            -webkit-user-select: none; user-select: none;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
        }

        body {
            background-color: #000000;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            color: #ffffff;
        }

        .header {
            padding: 50px 15px 10px;
            border-bottom: 0.5px solid #262626;
            background: rgba(18, 18, 18, 0.94);
            backdrop-filter: blur(20px);
            position: sticky; top: 0; z-index: 100;
            display: flex; flex-direction: column; align-items: center;
        }

        .avatar {
            width: 42px; height: 42px;
            border-radius: 50%;
            background: #3a3a3c url('adrian.jpg') center/cover;
            margin-bottom: 4px;
        }

        .name { font-size: 11px; color: #ffffff; font-weight: 400; opacity: 0.6; }

        .chat-container {
            flex: 1;
            padding: 20px 12px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .bubble {
            max-width: 75%;
            padding: 8px 16px;
            border-radius: 18px;
            font-size: 16px;
            line-height: 1.35;
            position: relative;
            margin-bottom: 2px;
            animation: bubbleSlide 0.3s ease-out;
        }

        @keyframes bubbleSlide {
            from { opacity: 0; transform: translateY(10px) scale(0.95); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }

        .received { align-self: flex-start; background-color: #262629; color: #ffffff; border-bottom-left-radius: 4px; }
        .sent { align-self: flex-end; background-color: #007aff; color: #ffffff; border-bottom-right-radius: 4px; }

        .typing { align-self: flex-start; background-color: #262629; padding: 12px 16px; border-radius: 18px; display: none; margin-bottom: 10px; }
        .dot { display: inline-block; width: 6px; height: 6px; background: #8e8e93; border-radius: 50%; margin-right: 3px; animation: wave 1.3s linear infinite; }
        .dot:nth-child(2) { animation-delay: -1.1s; }
        .dot:nth-child(3) { animation-delay: -0.9s; }
        @keyframes wave { 0%, 60%, 100% { transform: translateY(0); } 30% { transform: translateY(-5px); } }

        .choice-box { padding: 5px 15px 45px; background: #000000; display: flex; flex-direction: column; gap: 10px; }
        .choice-btn { background: #1c1c1e; color: #0a84ff; padding: 14px; border-radius: 12px; text-align: center; font-size: 15px; font-weight: 500; cursor: pointer; border: 0.5px solid #3a3a3c; }

        .gift-card { align-self: flex-start; width: 230px; background: #1c1c1e; border: 0.5px solid #3a3a3c; border-radius: 14px; margin-top: 10px; overflow: hidden; display: none; }
        .gift-img { height: 100px; background: #1b5e20; display: flex; align-items: center; justify-content: center; font-size: 40px; }
        .gift-info { padding: 12px; background: #2c2c2e; }
        .gift-info h4 { font-size: 14px; margin-bottom: 4px; }
        .gift-info p { font-size: 11px; color: #8e8e93; }

        #white-out { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: white; opacity: 0; z-index: 1000; pointer-events: none; transition: opacity 0.6s ease; }
    </style>
</head>
<body>

<div id="white-out"></div>
<div class="header">
    <div class="avatar"></div>
    <div class="name">Adrian ></div>
</div>

<div class="chat-container" id="chat">
    <div id="typing-indicator" class="typing"><span class="dot"></span><span class="dot"></span><span class="dot"></span></div>
</div>
<div class="choice-box" id="options"></div>

<script>
    document.addEventListener('contextmenu', e => e.preventDefault());
    const chat = document.getElementById('chat');
    const typing = document.getElementById('typing-indicator');
    const options = document.getElementById('options');
    const flash = document.getElementById('white-out');

    // SCENARIO OBJECT: Contains branching paths
    const flow = {
        start: {
            msgs: ["Yo! Merry Christmas, Yxzanie! üéâ", "How's your day going so far?"],
            choices: [
                { text: "Merry Christmas! It's good, just chilling. Hbu?", next: 'chill' },
                { text: "Merry Christmas! Pretty busy but fun. What's up?", next: 'busy' }
            ]
        },
        chill: {
            msgs: ["Nice, the best kind of holiday honestly.", "I've just been stuck with family stuff all morning.", "But I finally finished that project I was telling you about."],
            choices: [{ text: "The coding thing you were working on?", next: 'project' }]
        },
        busy: {
            msgs: ["Haha I feel that! Holidays can be chaotic.", "Glad it's the fun kind of busy though.", "I've been hiding in my room trying to finish this one thing lol."],
            choices: [{ text: "Wait, the project you mentioned before?", next: 'project' }]
        },
        project: {
            msgs: ["Yeah! I decided to turn it into a Christmas thing for you.", "It's not a physical gift, but it's much cooler.", "Took me a while to get the security right."],
            choices: [
                { text: "Security? Should I be worried? üòÇ", next: 'secure' },
                { text: "You're getting me hyped, let's see it!", next: 'ready' }
            ]
        },
        secure: {
            msgs: ["Haha no, it's just meant for you only.", "I don't want anyone else hacking into the server I set up.", "Ready to try it?"],
            choices: [{ text: "Okay, let's do this! Send it.", next: 'gift_launch' }]
        },
        ready: {
            msgs: ["Alright! It's a bit technical, so don't get confused.", "It's stored in an encrypted package.", "Launching now..."],
            choices: [{ text: "Bring it on! I'm ready.", next: 'gift_launch' }]
        }
    };

    function addBubble(text, side) {
        const b = document.createElement('div');
        b.className = `bubble ${side}`;
        b.innerText = text;
        chat.insertBefore(b, typing);
        chat.scrollTop = chat.scrollHeight;
        if (side === 'received' && "vibrate" in navigator) navigator.vibrate(10);
    }

    async function showPath(key) {
        if (key === 'gift_launch') {
            createGift();
            return;
        }

        const data = flow[key];
        for (let m of data.msgs) {
            typing.style.display = 'block';
            chat.appendChild(typing);
            chat.scrollTop = chat.scrollHeight;
            await new Promise(r => setTimeout(r, 1500));
            typing.style.display = 'none';
            addBubble(m, 'received');
        }

        options.innerHTML = '';
        data.choices.forEach(c => {
            const btn = document.createElement('div');
            btn.className = 'choice-btn';
            btn.innerText = c.text;
            btn.onclick = () => {
                addBubble(c.text, 'sent');
                options.innerHTML = '';
                setTimeout(() => showPath(c.next), 800);
            };
            options.appendChild(btn);
        });
    }

    function createGift() {
        typing.style.display = 'block';
        chat.appendChild(typing);
        setTimeout(() => {
            typing.style.display = 'none';
            const card = document.createElement('div');
            card.className = 'gift-card';
            card.style.display = 'block';
            card.id = 'active-gift';
            card.innerHTML = `
                <div class="gift-img">üéÅ</div>
                <div class="gift-info" id="gift-status">
                    <h4>XMAS_SECURE_PKG.zip</h4>
                    <p>Tap to initialize download</p>
                </div>
            `;
            card.onclick = () => startDownload(card);
            chat.insertBefore(card, typing);
            chat.scrollTop = chat.scrollHeight;
        }, 2000);
    }

    function startDownload(card) {
        card.onclick = null;
        const status = document.getElementById('gift-status');
        status.innerHTML = `<h4>Downloading Assets...</h4><div style="width: 100%; height: 4px; background: #3a3a3c; border-radius: 2px; margin-top: 8px; overflow: hidden;"><div id="p-fill" style="width: 0%; height: 100%; background: #0a84ff; transition: width 0.2s;"></div></div><p id="p-text" style="margin-top: 4px;">0%</p>`;
        
        let prog = 0;
        const inv = setInterval(() => {
            prog += Math.floor(Math.random() * 20) + 5;
            if (prog >= 100) {
                prog = 100; clearInterval(inv);
                status.innerHTML = "<h4>DOWNLOAD COMPLETE</h4><p>Redirecting to Terminal...</p>";
                if ("vibrate" in navigator) navigator.vibrate([100, 50, 100, 50, 300]);
                setTimeout(() => { flash.style.opacity = '1'; setTimeout(() => { window.location.href = "https://yazu5.github.io/4t/"; }, 600); }, 1000);
            }
            document.getElementById('p-fill').style.width = prog + '%';
            document.getElementById('p-text').innerText = prog + '%';
        }, 400);
    }

    showPath('start');
</script>
</body>
</html>
